<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ally.style.focusSource - ally.js</title><link rel="canonical" href="https://allyjs.io/api/style/focus-source.html">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../assets/website.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.css" data-noprefix="">
</head>
<body>
  <a href="#main" class="skip-to-content">Skip to content</a>
  <header>
    <h1 id="logo">ally.js</h1>
    <p id="claim"><em>JavaScript</em> library to help modern <em>web applications</em> with <em>accessibility</em> concerns by <strong>making accessibility simpler</strong></p>
    <nav id="site-navigation">
      <ul>
          
            <li class="">
              <a href="../../index.html">Home</a>
            </li>
          
            <li class="">
              <a href="../../getting-started.html">Getting Started</a>
            </li>
          
            <li class="active">
              <a href="../index.html">API</a>
            </li>
          
            <li class="">
              <a href="../../tutorials/index.html">Tutorials</a>
            </li>
          
            <li class="">
              <a href="../../contributing/index.html">Contributing</a>
            </li>
              <li class="download"><a href="../../getting-started.html#Downloading-the-UMD-bundle">Download</a></li>
        <li class="github"><a href="https://github.com/medialize/ally.js">Github</a></li>
      </ul>
    </nav></header>
  <div id="wrapper">
    <div id="navigation-column">
        <nav id="table-of-contents"><h1>On this page</h1><ul>
        <li><a href="#Description">Description</a></li>
        
        
        <li><a href="#Usage">Usage</a></li>
        
        
        <li><a href="#Service-handle">Service handle</a></li>
        
        
        <li><a href="#Examples">Examples</a></li>
        
        
        <li><a href="#Changes">Changes</a></li>
        
        
        <li><a href="#Related-resources">Related resources</a></li>
        
        
        <li><a href="#Contributing">Contributing</a></li>
        </ul></nav>
      <aside>
        <h1>Contribute to this page</h1>
        <ul id="collaboration-links">
          <li><a id="document-github-edit" href="https://github.com/medialize/ally.js/blob/master/docs/api/style/focus-source.md">edit this page on github</a></li>
          <li><a id="document-github-issue" data-title="ally.style.focusSource" href="https://github.com/medialize/ally.js/issues/new?title=[ally.style.focusSource]%20_your_problem_summary_">file an issue</a></li>
          <li></li>
        
      </ul></aside>
      <aside>
        <nav id="collection-navigation">
        
          <h1>More in <em>API</em></h1><ul>
          <li class="">
            <a class="" href="../index.html">API index</a>
          </li>
          
          
          <li class="">
            <a class="" href="../concepts.html">API concepts</a>
          </li>
          
          
          <li class="">
            <a class="" href="../element/blur.html">ally.element.blur</a>
          </li>
          
          
          <li class="">
            <a class="" href="../element/disabled.html">ally.element.disabled</a>
          </li>
          
          
          <li class="">
            <a class="" href="../element/focus.html">ally.element.focus</a>
          </li>
          
          
          <li class="">
            <a class="" href="../event/active-element.html">ally.event.activeElement</a>
          </li>
          
          
          <li class="">
            <a class="" href="../event/shadow-focus.html">ally.event.shadowFocus</a>
          </li>
          
          
          <li class="">
            <a class="" href="../fix/pointer-focus-children.html">ally.fix.pointerFocusChildren</a>
          </li>
          
          
          <li class="">
            <a class="" href="../fix/pointer-focus-input.html">ally.fix.pointerFocusInput</a>
          </li>
          
          
          <li class="">
            <a class="" href="../fix/pointer-focus-parent.html">ally.fix.pointerFocusParent</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/active-element.html">ally.get.activeElement</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/active-elements.html">ally.get.activeElements</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/focus-redirect-target.html">ally.get.focusRedirectTarget</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/focus-target.html">ally.get.focusTarget</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/insignificant-branches.html">ally.get.insignificantBranches</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/parents.html">ally.get.parents</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/shadow-host.html">ally.get.shadowHost</a>
          </li>
          
          
          <li class="">
            <a class="" href="../get/shadow-host-parents.html">ally.get.shadowHostParents</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/active-element.html">ally.is.activeElement</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/disabled.html">ally.is.disabled</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/focusable.html">ally.is.focusable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/focus-relevant.html">ally.is.focusRelevant</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/only-tabbable.html">ally.is.onlyTabbable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/shadowed.html">ally.is.shadowed</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/tabbable.html">ally.is.tabbable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/valid-area.html">ally.is.validArea</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/valid-tabindex.html">ally.is.validTabindex</a>
          </li>
          
          
          <li class="">
            <a class="" href="../is/visible.html">ally.is.visible</a>
          </li>
          
          
          <li class="">
            <a class="" href="../maintain/disabled.html">ally.maintain.disabled</a>
          </li>
          
          
          <li class="">
            <a class="" href="../maintain/hidden.html">ally.maintain.hidden</a>
          </li>
          
          
          <li class="">
            <a class="" href="../maintain/tab-focus.html">ally.maintain.tabFocus</a>
          </li>
          
          
          <li class="">
            <a class="" href="../map/attribute.html">ally.map.attribute</a>
          </li>
          
          
          <li class="">
            <a class="" href="../map/keycode.html">ally.map.keycode</a>
          </li>
          
          
          <li class="">
            <a class="" href="../observe/interaction-type.html">ally.observe.interactionType</a>
          </li>
          
          
          <li class="">
            <a class="" href="../observe/shadow-mutations.html">ally.observe.shadowMutations</a>
          </li>
          
          
          <li class="">
            <a class="" href="../query/first-tabbable.html">ally.query.firstTabbable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../query/focusable.html">ally.query.focusable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../query/shadow-hosts.html">ally.query.shadowHosts</a>
          </li>
          
          
          <li class="">
            <a class="" href="../query/tabbable.html">ally.query.tabbable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../query/tabsequence.html">ally.query.tabsequence</a>
          </li>
          
          
          <li class="active">
            <a class="" href="focus-source.html">ally.style.focusSource</a>
          </li>
          
          
          <li class="">
            <a class="" href="focus-within.html">ally.style.focusWithin</a>
          </li>
          
          
          <li class="">
            <a class="" href="../when/focusable.html">ally.when.focusable</a>
          </li>
          
          
          <li class="">
            <a class="" href="../when/key.html">ally.when.key</a>
          </li>
          
          
          <li class="">
            <a class="" href="../when/visible-area.html">ally.when.visibleArea</a>
          </li>
          
          
          <li class="">
            <a class="" href="../prototype.html">Prototype polyfills</a>
          </li>
          
          
          <li class="">
            <a class="" href="../selector.html">Selector</a>
          </li>
          
          
          <li class="">
            <a class="" href="../supports.html">Supports - Browser compatibility</a>
          </li>
          
          
          <li class="">
            <a class="" href="../util.html">Utilities</a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          </ul>
        </nav>      </aside>
    </div>

    <main id="main" tabindex="-1">
      <h1><a id="ally-style-focusSource" href="#ally-style-focusSource" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>ally.style.focusSource</h1>
<p>Differentiate the causes of focus change for when different visual styles need to applied.</p>
<h2><a id="Description" href="#Description" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Description</h2>
<p>The utility identifies <code>pointer</code> (mouse, touch), <code>key</code> (keyboard) and <code>script</code> as sources for an element being focused. The information is made available to CSS via <code>&lt;html data-focus-source=&quot;key&quot;&gt;</code>. The classes <code>.focus-source-key</code>, <code>.focus-source-pointer</code>, <code>.focus-source-script</code> are made available on <code>&lt;html&gt;</code> when the respective focus source occurs for the first time. When the utility is initialized, the focus source is <code>&lt;html data-focus-source=&quot;initial&quot;&gt;</code>.</p>
<p>This module allows the document to style <code>:focus</code> as follows:</p>
<pre><code class="language-css">body :focus {
  /* default styling in case JS broke */
  background: yellow;
}
html[data-focus-source=&quot;initial&quot;] &gt; body :focus {
  /* styling for when focus was not changed yet */
  background: green;
}
html[data-focus-source=&quot;pointer&quot;] &gt; body :focus {
  /* styling for when focus was given by pointer (mouse, touch) */
  background: red;
}
html[data-focus-source=&quot;key&quot;] &gt; body :focus {
  /* styling for when focus was given by keyboard */
  background: blue;
}
html[data-focus-source=&quot;script&quot;] &gt; body :focus {
  /* styling for when focus was given by neither pointer nor keyboard */
  background: orange;
}

html.focus-source-key &gt; body :focus {
  /* styling for when focus was changed at least once using the keyboard */
  background: magenta;
}
</code></pre>
<p>The focus changes are also observed within the ShadowDOM, allowing the document styles to descend into the dark:</p>
<pre><code class="language-css">html[data-focus-source=&quot;pointer&quot;] &gt;&gt;&gt; :focus {
  /* styling for when focus was given by pointer (mouse, touch) */
  background: red;
}

/* older shadow-piercing-combinator notation */
html[data-focus-source=&quot;pointer&quot;] /deep/ :focus {
  /* styling for when focus was given by pointer (mouse, touch) */
  background: red;
}
</code></pre>
<h2><a id="Usage" href="#Usage" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Usage</h2>
<pre><code class="language-javascript">var handle = ally.style.focusSource();

handle.disengage();

// get current focus source
handle.current(); // &quot;key&quot;, &quot;pointer&quot;, &quot;script&quot;

// test if a focus source has occurred at least once before
handle.used(&apos;key&apos;); // true, false

// make all focus events use a specific source type
// regardless of the identified interaction type
handle.lock(&apos;pointer&apos;);
// revert locking into a specific source type
handle.unlock();
</code></pre>
<p>The identified focus source is retained when shifting focus to another element:</p>
<pre><code class="language-javascript">var handle = ally.style.focusSource();

element.addEventListener(&apos;click&apos;, function() {
  otherElement.focus();
});
</code></pre>
<p>Use <code>.lock()</code> to retain the identified focus source when shifting focus asynchronously:</p>
<pre><code class="language-javascript">var handle = ally.style.focusSource();

element.addEventListener(&apos;click&apos;, function() {
  handle.lock(handle.current());
  setTimeout(function() {
    otherElement.focus();
    handle.unlock();
  });
});
</code></pre>

<h3><a id="Returns" href="#Returns" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Returns</h3>
<p>A <a href="../concepts.html#Global-service"><code>&lt;global-service&gt;</code></a> interface, providing the <code>handle.disengage()</code> method to stop the service.</p>

<h2><a id="Service-handle" href="#Service-handle" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Service handle</h2>
<p>The <code>handle</code> is returned when engaging the service. As the <a href="../concepts.html#Global-service"><code>&lt;global-service&gt;</code></a> interface describes, the <code>handle.disengage()</code> method is provided to stop the service. Additionally the following methods are made available:</p>
<h3><a id="handle-current" href="#handle-current" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>handle.current()</h3>
<p>The <code>handle.current()</code> method does not accept any arguments and returns one of the following strings <code>&quot;key&quot;</code>, <code>&quot;pointer&quot;</code>, <code>&quot;script&quot;</code>, depending on the current interaction type.</p>
<h3><a id="handle-used-string" href="#handle-used-string" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>handle.used(<code>&lt;string&gt;</code>)</h3>
<p>The <code>handle.used()</code> method accepts one string argument and returns <code>true</code> if that interaction type has ever been used before.</p>
<h3><a id="handle-lock-string" href="#handle-lock-string" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>handle.lock(<code>&lt;string&gt;</code>)</h3>
<p>The <code>handle.lock()</code> method accepts one string argument and sets that as the interaction type for all subsequent <code>handle.current()</code> invocations.</p>
<h3><a id="handle-unlock" href="#handle-unlock" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>handle.unlock()</h3>
<p>The <code>handle.unlock()</code> method releases the focus-source lock.</p>
<h2><a id="Examples" href="#Examples" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Examples</h2>
<section class="example"><h1><a id="Example-ally-style-focusSource-Example" href="#Example-ally-style-focusSource-Example" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Example: ally.style.focusSource Example</h1><a class="jsbin-embed" href="https://jsbin.com/ziduzu/embed?output">ally.style.focusSource Example on jsbin.com</a><script src="https://static.jsbin.com/js/embed.min.js?3.35.3"></script><p><a href="https://jsbin.com/ziduzu/edit" target="_blank">play with the example on jsbin.com</a> or <a href="./focus-source.example.html" target="_blank">open the source document</a></p></section>
<h2><a id="Changes" href="#Changes" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Changes</h2>
<ul>
<li>In <code>v1.3.0</code> the method <code>handle.unlock()</code> was added to supersede <code>handle.lock(false)</code>, which is still available, but removed from documentation.</li>
</ul>

<h2><a id="Related-resources" href="#Related-resources" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Related resources</h2>
<ul>
<li><a href="https://discourse.wicg.io/t/exposing-a-users-input-modality/1067">WICG: Exposing a user&#x2019;s input modality</a> and accompanying <a href="https://github.com/alice/modality">prollyfill</a></li>
</ul>
<h2><a id="Contributing" href="#Contributing" class="link-to-headline" aria-label="link to headline">&#x1F517;</a>Contributing</h2>
<ul>
<li><a href="https://github.com/medialize/ally.js/blob/master/src/style/focus-source.js">module source</a></li>
<li><a href="https://github.com/medialize/ally.js/blob/master/docs/api/style/focus-source.md">document source</a></li>
<li><a href="https://github.com/medialize/ally.js/blob/master/test/unit/style.focus-source.test.js">unit test</a></li>
</ul>

    </main>
  </div>

  <footer>
    <p>ally.js is published under the <a href="https://opensource.org/licenses/mit-license">MIT License</a>.</p>
    <p><a href="../../legal.html">Legal</a>, <a href="https://github.com/medialize/ally.js">Github</a>, <a href="https://twitter.com/allyjs_io">@allyjs_io</a>.</p>
    <p>Created By <a href="https://twitter.com/rodneyrehm">Rodney Rehm</a>.</p>
  </footer>
  <script src="../../assets/website.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js" defer></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-8922143-6', 'auto');
    ga('send', 'pageview');
  </script></body>
</html>